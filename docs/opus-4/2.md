# üìä Consolidated Review & Analysis
## PowerPoint Agent Tools v3.1.0 ‚Äî Complete Technical Deep-Dive

---

## Executive Summary

**PowerPoint Agent Tools** is a sophisticated, production-grade toolkit enabling AI agents to programmatically create, modify, and validate PowerPoint presentations with precision, safety, and visual intelligence. The system comprises **39 stateless CLI utilities** built atop a centralized core library, designed for deterministic, auditable, and accessible presentation engineering.

---

# Part 1: THE WHAT ‚Äî Project Identity & Components

## 1.1 Core Identity

| Attribute | Value |
|-----------|-------|
| **Project Name** | PowerPoint Agent Tools |
| **Current Version** | 3.1.0 |
| **Nature** | Suite of stateless CLI utilities for programmatic `.pptx` manipulation |
| **Primary Technology** | Python 3.8+ with `python-pptx` as underlying library |
| **Architecture Pattern** | Hub-and-Spoke (Core library + CLI tool wrappers) |
| **Target Users** | AI agents, automation engineers, accessibility specialists |

## 1.2 Component Inventory

### Directory Structure
```
powerpoint-agent-tools/
‚îú‚îÄ‚îÄ core/                                # THE HUB
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                      # Public API exports
‚îÇ   ‚îú‚îÄ‚îÄ powerpoint_agent_core.py         # All core logic (PowerPointAgent class)
‚îÇ   ‚îî‚îÄ‚îÄ strict_validator.py              # JSON Schema validation with caching
‚îú‚îÄ‚îÄ tools/                               # THE SPOKES (39 CLI utilities)
‚îÇ   ‚îú‚îÄ‚îÄ ppt_add_shape.py
‚îÇ   ‚îú‚îÄ‚îÄ ppt_get_info.py
‚îÇ   ‚îú‚îÄ‚îÄ ppt_capability_probe.py
‚îÇ   ‚îî‚îÄ‚îÄ ... (36+ more tools)
‚îú‚îÄ‚îÄ schemas/                             # JSON Schemas for validation
‚îÇ   ‚îú‚îÄ‚îÄ manifest.schema.json
‚îÇ   ‚îî‚îÄ‚îÄ tool_output_schemas/
‚îú‚îÄ‚îÄ tests/                               # Comprehensive test suite
‚îÇ   ‚îú‚îÄ‚îÄ test_core.py
‚îÇ   ‚îú‚îÄ‚îÄ test_shape_opacity.py
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îú‚îÄ‚îÄ AGENT_SYSTEM_PROMPT.md               # System prompt for AI agents
‚îú‚îÄ‚îÄ CONTRIBUTING_TOOLS.md                # Tool creation guide
‚îî‚îÄ‚îÄ requirements.txt                     # Dependencies
```

### Tool Catalog (39 Tools Across 8 Domains)

| Domain | Tools | Count |
|--------|-------|-------|
| **Creation** | `ppt_create_new`, `ppt_create_from_template`, `ppt_create_from_structure`, `ppt_clone_presentation` | 4 |
| **Slides** | `ppt_add_slide`, `ppt_delete_slide`, `ppt_duplicate_slide`, `ppt_reorder_slides`, `ppt_set_slide_layout`, `ppt_set_footer` | 6 |
| **Content** | `ppt_set_title`, `ppt_add_text_box`, `ppt_add_bullet_list`, `ppt_format_text`, `ppt_replace_text`, `ppt_add_notes` | 6 |
| **Images** | `ppt_insert_image`, `ppt_replace_image`, `ppt_crop_image`, `ppt_set_image_properties` | 4 |
| **Shapes** | `ppt_add_shape`, `ppt_format_shape`, `ppt_add_connector`, `ppt_set_background`, `ppt_set_z_order`, `ppt_remove_shape` | 6 |
| **Data Viz** | `ppt_add_chart`, `ppt_update_chart_data`, `ppt_format_chart`, `ppt_add_table` | 4 |
| **Inspection** | `ppt_get_info`, `ppt_get_slide_info`, `ppt_extract_notes`, `ppt_capability_probe` | 4 |
| **Validation** | `ppt_validate_presentation`, `ppt_check_accessibility`, `ppt_export_images`, `ppt_export_pdf` | 4 |

### Core Library Components

| Component | Location | Responsibility |
|-----------|----------|----------------|
| **PowerPointAgent** | `core/powerpoint_agent_core.py` | Context manager class; all file operations |
| **PathValidator** | `core/powerpoint_agent_core.py` | Security-hardened path validation |
| **Position/Size Resolver** | `core/powerpoint_agent_core.py` | Resolve %, inches, anchor, grid positioning |
| **ColorHelper** | `core/powerpoint_agent_core.py` | Hex parsing, contrast calculation |
| **StrictValidator** | `core/strict_validator.py` | JSON Schema validation with format checkers |

---

# Part 2: THE WHY ‚Äî Mission, Philosophy & Design Rationale

## 2.1 Core Mission

> **"Enabling AI agents to engineer presentations with precision, safety, and visual intelligence"**

The project exists to solve a fundamental problem: AI agents need reliable, deterministic, and safe mechanisms to create professional presentations without risking data corruption or accessibility violations.

## 2.2 The Five Design Pillars

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DESIGN PILLARS                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  STATELESS   ‚îÇ    ATOMIC    ‚îÇ  COMPOSABLE  ‚îÇ  ACCESSIBLE  ‚îÇ VISUAL-AWARE‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Each call    ‚îÇ Open‚ÜíModify  ‚îÇ Tools chain  ‚îÇ WCAG 2.1     ‚îÇ Typography  ‚îÇ
‚îÇ independent  ‚îÇ ‚ÜíSave‚ÜíClose  ‚îÇ together     ‚îÇ compliance   ‚îÇ & color     ‚îÇ
‚îÇ No memory    ‚îÇ One action   ‚îÇ Output feeds ‚îÇ Alt text,    ‚îÇ theory      ‚îÇ
‚îÇ of previous  ‚îÇ per call     ‚îÇ next input   ‚îÇ contrast,    ‚îÇ built-in    ‚îÇ
‚îÇ calls        ‚îÇ              ‚îÇ              ‚îÇ reading order‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Why These Pillars Matter

| Pillar | Problem Solved | Implementation |
|--------|----------------|----------------|
| **Stateless** | AI agents may lose context between calls; prevents race conditions | Each tool opens, operates, saves, closes independently |
| **Atomic** | Partial failures must not corrupt files | Single action per call; fail safely |
| **Composable** | Complex workflows require chaining | JSON output feeds next input; stdout is machine-parseable |
| **Accessible** | Legal requirements; inclusive design | Built-in WCAG validation; alt text enforcement |
| **Visual-Aware** | Professional quality requires design intelligence | Typography scales, color theory, density rules |

## 2.3 Safety Hierarchy

The project implements a strict safety hierarchy that governs all operations:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SAFETY HIERARCHY (in order of precedence)                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  1. Never perform destructive operations without approval   ‚îÇ
‚îÇ  2. Always work on cloned copies, never source files        ‚îÇ
‚îÇ  3. Validate before delivery, always                        ‚îÇ
‚îÇ  4. Fail safely‚Äîincomplete is better than corrupted         ‚îÇ
‚îÇ  5. Document everything for audit and rollback              ‚îÇ
‚îÇ  6. Refresh indices after structural changes                ‚îÇ
‚îÇ  7. Dry-run before actual execution for replacements        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## 2.4 The Governance Contract

### Clone-Before-Edit Principle
**MANDATORY**: Never modify source files directly. This is the first, non-negotiable rule.

```python
# ‚úÖ CORRECT workflow
agent.clone_presentation(source=Path("/source/template.pptx"), output=Path("/work/modified.pptx"))
# Now operate ONLY on the work copy
```

### Approval Token System
Destructive operations require cryptographically-signed approval tokens:

| Operation | Requires Token |
|-----------|----------------|
| `ppt_delete_slide` | ‚úÖ Yes |
| `ppt_remove_shape` | ‚úÖ Yes |
| Mass text replacement | ‚úÖ Yes (without dry-run) |
| Background replacement (all slides) | ‚úÖ Yes |
| Operations marked `critical: true` | ‚úÖ Yes |

### Presentation Version Tracking
Every mutation captures before/after state hashes to detect conflicts:

```json
{
  "presentation_version_before": "a1b2c3d4",
  "presentation_version_after": "e5f6g7h8"
}
```

---

# Part 3: THE HOW ‚Äî Architecture, Patterns & Implementation

## 3.1 Hub-and-Spoke Architecture

```
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ    AI Agent / Human         ‚îÇ
                         ‚îÇ    (Orchestration Layer)    ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                       ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                  ‚îÇ                  ‚îÇ
                    ‚ñº                  ‚ñº                  ‚ñº
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ ppt_add_      ‚îÇ  ‚îÇ ppt_get_      ‚îÇ  ‚îÇ ppt_validate_ ‚îÇ
           ‚îÇ shape.py      ‚îÇ  ‚îÇ slide_info.py ‚îÇ  ‚îÇ presentation  ‚îÇ
           ‚îÇ   (SPOKE)     ‚îÇ  ‚îÇ   (SPOKE)     ‚îÇ  ‚îÇ   (SPOKE)     ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ                  ‚îÇ                  ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ     powerpoint_agent_core.py        ‚îÇ
                    ‚îÇ              (HUB)                  ‚îÇ
                    ‚îÇ                                     ‚îÇ
                    ‚îÇ   ‚Ä¢ PowerPointAgent class           ‚îÇ
                    ‚îÇ   ‚Ä¢ All XML manipulation            ‚îÇ
                    ‚îÇ   ‚Ä¢ File locking & versioning       ‚îÇ
                    ‚îÇ   ‚Ä¢ Position/Size resolution        ‚îÇ
                    ‚îÇ   ‚Ä¢ Color & accessibility helpers   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ            python-pptx              ‚îÇ
                    ‚îÇ        (Underlying Library)         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Role Separation

| Layer | Responsibility | State |
|-------|----------------|-------|
| **Orchestrator** (AI Agent) | Workflow coordination, decision-making | Maintains context |
| **Spoke Tools** | CLI interface, argument parsing, JSON formatting | Stateless |
| **Hub Core** | All PowerPoint operations, file handling | Stateful while open, ephemeral |
| **python-pptx** | Low-level `.pptx` manipulation | Library-managed |

## 3.2 The Statelessness Contract

```python
# ‚úÖ CORRECT: Each call is independent and self-contained
with PowerPointAgent(filepath) as agent:
    agent.open(filepath)
    agent.add_shape(slide_index=0, shape_type="rectangle", ...)
    agent.save()
# File is closed, lock released, no state retained

# ‚ùå WRONG: Assuming state persists between calls
agent.add_shape(...)  # Will fail - no file open
```

**Why Statelessness Matters:**
1. AI agents may lose context between calls
2. Prevents race conditions in parallel execution
3. Enables pipeline composition (`tool1 | tool2 | tool3`)
4. Simplifies error recovery
5. Makes the system predictable and deterministic

## 3.3 The 5-Phase Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PHASE 0: INTAKE     ‚îÇ  Classify request (SIMPLE/STANDARD/COMPLEX)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PHASE 1: DISCOVER   ‚îÇ  Deep probe, capture capabilities & version     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PHASE 2: PLAN       ‚îÇ  Create change manifest, document decisions     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PHASE 3: CREATE     ‚îÇ  Execute operations with version tracking       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PHASE 4: VALIDATE   ‚îÇ  Quality assurance, accessibility audit         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PHASE 5: DELIVER    ‚îÇ  Production handoff with documentation          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Phase-Specific Requirements

| Phase | Key Tools | Critical Requirements |
|-------|-----------|----------------------|
| **DISCOVER** | `ppt_capability_probe`, `ppt_get_info`, `ppt_get_slide_info` | Timeout handling (15s), fallback probes, comprehensive metadata |
| **PLAN** | `ppt_create_from_structure` | Schema validation, design rationale documentation |
| **CREATE** | `ppt_add_*`, `ppt_replace_*`, `ppt_set_*` | Version tracking, approval tokens, index freshness |
| **VALIDATE** | `ppt_validate_presentation`, `ppt_check_accessibility` | WCAG 2.1 compliance, structural validation |
| **DELIVER** | `ppt_export_pdf`, `ppt_extract_notes` | Complete audit trails, rollback commands |

## 3.4 Critical Patterns

### Pattern 1: The Shape Index Problem

**Problem**: Shape indices are positional and shift after structural operations.

```python
# ‚ùå WRONG - indices become stale
result1 = agent.add_shape(slide_index=0, ...)  # Returns shape_index: 5
result2 = agent.add_shape(slide_index=0, ...)  # Returns shape_index: 6
agent.remove_shape(slide_index=0, shape_index=5)
agent.format_shape(slide_index=0, shape_index=6, ...)  # ‚ùå Now index 5!

# ‚úÖ CORRECT - re-query after structural changes
result1 = agent.add_shape(slide_index=0, ...)
agent.remove_shape(slide_index=0, shape_index=result1["shape_index"])
slide_info = agent.get_slide_info(slide_index=0)  # REFRESH!
# Find target by name, not cached index
```

**Operations That Invalidate Indices:**

| Operation | Effect |
|-----------|--------|
| `add_shape()` | Adds new index at end |
| `remove_shape()` | Shifts subsequent indices down |
| `set_z_order()` | Reorders ALL indices |
| `delete_slide()` | Invalidates all indices on slide |

### Pattern 2: The Overlay Pattern

```python
# Complete overlay workflow for text readability
# 1. Add overlay shape with opacity
result = agent.add_shape(
    slide_index=0,
    shape_type="rectangle",
    position={"left": "0%", "top": "0%"},
    size={"width": "100%", "height": "100%"},
    fill_color="#FFFFFF",
    fill_opacity=0.15  # 15% opaque (subtle)
)
overlay_index = result["shape_index"]

# 2. IMMEDIATELY refresh indices
slide_info = agent.get_slide_info(slide_index=0)

# 3. Send overlay to back
agent.set_z_order(slide_index=0, shape_index=overlay_index, action="send_to_back")

# 4. IMMEDIATELY refresh indices again
slide_info = agent.get_slide_info(slide_index=0)
```

### Pattern 3: Probe Resilience

Discovery tools implement a 3-layer resilience pattern:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  LAYER 1: Timeout Detection                                 ‚îÇ
‚îÇ  - Check elapsed time at EACH iteration                     ‚îÇ
‚îÇ  - Stop gracefully on timeout, return partial results       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  LAYER 2: Transient Slides                                  ‚îÇ
‚îÇ  - Add temporary slide for accurate placeholder analysis    ‚îÇ
‚îÇ  - Remove via finally block (no save = no file change)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  LAYER 3: Graceful Degradation                              ‚îÇ
‚îÇ  - Always return partial results + warnings                 ‚îÇ
‚îÇ  - Include analysis_complete flag                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Pattern 4: Opacity vs Transparency

```
OPACITY (Modern - USE THIS):
0.0 ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ 1.0
Invisible                    Fully visible

TRANSPARENCY (Deprecated):
1.0 ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ 0.0
Invisible                    Fully visible

CONVERSION: opacity = 1.0 - transparency
```

```python
# ‚úÖ MODERN (v3.1.0+)
agent.add_shape(fill_color="#0070C0", fill_opacity=0.15)

# ‚ö†Ô∏è DEPRECATED (logs warning, will be removed in v4.0)
agent.format_shape(transparency=0.85)  # Converts to fill_opacity=0.15
```

## 3.5 Tool Implementation Template

```python
#!/usr/bin/env python3
"""Standard Tool Template v3.1.0"""
import sys
import os

# --- HYGIENE BLOCK START ---
sys.stderr = open(os.devnull, 'w')  # Suppress library noise
# --- HYGIENE BLOCK END ---

import json
import argparse
from pathlib import Path
from typing import Dict, Any

sys.path.insert(0, str(Path(__file__).parent.parent))

from core.powerpoint_agent_core import (
    PowerPointAgent, PowerPointAgentError,
    SlideNotFoundError, ShapeNotFoundError
)

def tool_logic(filepath: Path, param: str) -> Dict[str, Any]:
    """Main logic with version tracking."""
    if not filepath.exists():
        raise FileNotFoundError(f"File not found: {filepath}")
    
    with PowerPointAgent(filepath) as agent:
        agent.open(filepath)
        
        # 1. Capture version BEFORE
        info_before = agent.get_presentation_info()
        version_before = info_before["presentation_version"]
        
        # 2. Execute operation
        result = agent.some_method(param)
        
        # 3. Save
        agent.save()
        
        # 4. Capture version AFTER
        info_after = agent.get_presentation_info()
        version_after = info_after["presentation_version"]
    
    return {
        "status": "success",
        "file": str(filepath),
        "presentation_version_before": version_before,
        "presentation_version_after": version_after,
        "data": result
    }

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--file', required=True, type=Path)
    parser.add_argument('--param', required=True)
    parser.add_argument('--json', action='store_true', default=True)
    args = parser.parse_args()

    try:
        result = tool_logic(args.file, args.param)
        sys.stdout.write(json.dumps(result, indent=2) + "\n")
        sys.exit(0)
    except Exception as e:
        error = {"status": "error", "error": str(e), "error_type": type(e).__name__}
        sys.stdout.write(json.dumps(error, indent=2) + "\n")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

## 3.6 Data Structures

### Position Dictionary

| Type | Format | Example |
|------|--------|---------|
| **Percentage** (recommended) | `{"left": "10%", "top": "20%"}` | Responsive |
| **Inches** (absolute) | `{"left": 1.5, "top": 2.0}` | Precise |
| **Anchor** | `{"anchor": "center", "offset_x": 0, "offset_y": -0.5}` | Layout-aware |
| **Grid** (12-column) | `{"grid_row": 2, "grid_col": 3, "grid_size": 12}` | Structured |

### Exit Code Matrix

| Code | Category | Meaning | Retryable |
|------|----------|---------|-----------|
| 0 | Success | Operation completed | N/A |
| 1 | Usage Error | Invalid arguments | No |
| 2 | Validation Error | Schema/content invalid | No |
| 3 | Transient Error | Timeout, I/O | Yes |
| 4 | Permission Error | Approval token missing | No |
| 5 | Internal Error | Unexpected failure | Maybe |

## 3.7 Design Intelligence System

### Typography Scale

| Element | Min | Recommended | Max |
|---------|-----|-------------|-----|
| Main Title | 36pt | 44pt | 60pt |
| Slide Title | 28pt | 32pt | 40pt |
| Body Text | 16pt | 18pt | 24pt |
| Captions | 12pt | 14pt | 16pt |
| **NEVER BELOW** | **10pt** | ‚Äî | ‚Äî |

### The 6√ó6 Content Density Rule

```
STANDARD:
‚îú‚îÄ‚îÄ Maximum 6 bullet points per slide
‚îú‚îÄ‚îÄ Maximum 6 words per bullet point
‚îî‚îÄ‚îÄ One key message per slide
```

### Color Priority

```
1. Extract from theme (probe first!)
2. Use theme colors for consistency
3. Fallback to canonical palettes only if needed
4. Maximum 5 colors per presentation
```

## 3.8 Accessibility Requirements

| Check | Requirement | Remediation Tool |
|-------|-------------|------------------|
| Alt text | All images must have descriptive text | `ppt_set_image_properties --alt-text` |
| Contrast | ‚â•4.5:1 (body), ‚â•3:1 (large text) | `ppt_format_text --color` |
| Font size | No text below 10pt | `ppt_format_text --font-size` |
| Reading order | Logical tab order | Manual reordering |

---

# Part 4: Key Implementation Considerations

## 4.1 The Five Golden Rules

| # | Rule | Why |
|---|------|-----|
| üîí | **Clone** ‚Äî Never edit source files | Prevents data loss |
| üîç | **Probe** ‚Äî Discover before guessing | Avoids layout errors |
| üîÑ | **Refresh** ‚Äî Indices shift after changes | Prevents stale references |
| üìä | **JSON** ‚Äî stdout is for JSON only | Enables machine parsing |
| ‚ôø | **Validate** ‚Äî Check accessibility always | Creates inclusive output |

## 4.2 Common Gotchas

| Gotcha | Problem | Solution |
|--------|---------|----------|
| Stale shape indices | Operations fail silently | Always refresh after structural changes |
| stdout pollution | JSON parsing fails | Use hygiene block, stderr for logs |
| Version mismatch | Race condition detected | Re-probe and update manifest |
| Layout guessing | Layout doesn't exist | Always probe for available layouts |
| Hardcoded paths | Platform incompatibility | Use `pathlib.Path` exclusively |

## 4.3 Testing Requirements

| Category | What to Test |
|----------|--------------|
| Happy Path | Normal usage succeeds |
| Edge Cases | Boundary values (0, 1, max, empty) |
| Error Cases | Invalid inputs raise correct exceptions |
| Governance | Clone-before-edit enforced, tokens validated |
| Version Tracking | Before/after versions captured |
| Index Freshness | Indices refreshed after structural changes |

---

# Part 5: Questions for Clarification

Based on my analysis, I have the following questions to ensure complete understanding:

1. **Approval Token Implementation**: The token system is described conceptually‚Äîis there an existing implementation in `core/`, or is this planned for future development?

2. **Strict Validator Integration**: How extensively are JSON schemas currently enforced? Are all tool outputs validated against schemas in CI/CD?

3. **PDF Export**: The `ppt_export_pdf.py` tool requires LibreOffice‚Äîis there a fallback for environments without LibreOffice?

4. **Chart Update Limitations**: Given python-pptx's limited chart support, are there guidelines for when to delete/recreate vs. attempt update?

5. **Transient Slide Cleanup**: In probe resilience, if cleanup fails, is there any residual impact given no `save()` is called?

---

## ‚úÖ Analysis Complete

I now have comprehensive understanding of:
- **Architecture**: Hub-and-spoke, stateless CLI tools wrapping core library
- **Philosophy**: Safety-first, accessible, visual-aware design
- **Patterns**: Clone-before-edit, probe-first, refresh-after-change
- **Implementation**: Version tracking, approval tokens, JSON-first I/O
- **Workflow**: 5-phase operational protocol with governance gates

**Ready to assist with any development, debugging, or enhancement tasks for PowerPoint Agent Tools.**
