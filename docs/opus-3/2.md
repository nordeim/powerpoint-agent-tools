# Consolidated Review & Analysis: PowerPoint Agent Tools

## Executive Summary

I have completed a thorough analysis of all uploaded documentation for the **PowerPoint Agent Tools** project. This analysis synthesizes the README, Architecture Overview, Agent System Prompt, and Tool Development Guide into a unified understanding of the project's WHAT, WHY, and HOW.

---

## ğŸ“‹ Document Inventory Received

| # | Document | Primary Focus | Key Sections |
|---|----------|---------------|--------------|
| 1 | **README.md + Architecture** | Technical specification, developer onboarding | Quick Start, Architecture, Design Philosophy, Patterns, Testing |
| 2 | **AGENT_SYSTEM_PROMPT.md** | AI agent operational framework | Governance, Workflow Phases, Design Intelligence, Response Protocol |
| 3 | **Tool Development Guide** | Tool creation handbook | Templates, API Reference, Error Handling, Resilience Patterns |

---

# Part I: THE WHAT â€” Complete Feature Inventory

## 1.1 Project Identity

| Attribute | Value |
|-----------|-------|
| **Name** | PowerPoint Agent Tools |
| **Version** | 3.1.0 |
| **Mission** | "Enabling AI agents to engineer presentations with precision, safety, and visual intelligence" |
| **Architecture** | Hub-and-Spoke (Core library + 39 CLI tools) |
| **Primary Users** | AI agents, automation engineers, human developers, accessibility specialists |

## 1.2 Core Capabilities Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CAPABILITY DOMAINS (39 Tools)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   CREATION      â”‚   MANIPULATION  â”‚   INSPECTION    â”‚   VALIDATION          â”‚
â”‚   (4 tools)     â”‚   (22 tools)    â”‚   (4 tools)     â”‚   (4 tools)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ create_new    â”‚ â€¢ add_slide     â”‚ â€¢ get_info      â”‚ â€¢ validate_present.   â”‚
â”‚ â€¢ create_from_  â”‚ â€¢ delete_slide  â”‚ â€¢ get_slide_    â”‚ â€¢ check_accessib.     â”‚
â”‚   template      â”‚ â€¢ add_shape     â”‚   info          â”‚ â€¢ export_images       â”‚
â”‚ â€¢ create_from_  â”‚ â€¢ format_shape  â”‚ â€¢ extract_notes â”‚ â€¢ export_pdf          â”‚
â”‚   structure     â”‚ â€¢ add_text_box  â”‚ â€¢ capability_   â”‚                       â”‚
â”‚ â€¢ clone_present.â”‚ â€¢ add_chart     â”‚   probe         â”‚                       â”‚
â”‚                 â”‚ â€¢ add_table     â”‚                 â”‚                       â”‚
â”‚                 â”‚ â€¢ set_z_order   â”‚                 â”‚                       â”‚
â”‚                 â”‚ â€¢ add_notes     â”‚                 â”‚                       â”‚
â”‚                 â”‚ â€¢ replace_text  â”‚                 â”‚                       â”‚
â”‚                 â”‚ â€¢ ... (12 more) â”‚                 â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.3 v3.1.0 Feature Highlights

| Feature | Description | Technical Detail |
|---------|-------------|------------------|
| **Opacity Support** | Semi-transparent shapes/fills | `fill_opacity`, `line_opacity` (0.0-1.0 scale) |
| **Overlay Mode** | Quick background overlays | `--overlay` preset with sensible defaults |
| **Z-Order Control** | Shape layering via XML | `set_z_order()` with 4 actions |
| **Speaker Notes** | Full notes management | `add_notes()` with append/prepend/overwrite modes |
| **Surgical Replace** | Scoped text replacement | `--slide N --shape M` targeting |
| **Version Tracking** | Race condition prevention | SHA-256 hash of presentation state |
| **Transparency Deprecation** | Migration to opacity model | Auto-conversion with warnings |

## 1.4 Complete Tool Catalog

### Domain 1: Creation & Architecture (4 tools)
| Tool | Purpose | Critical Args |
|------|---------|---------------|
| `ppt_create_new` | Initialize blank deck | `--output PATH` |
| `ppt_create_from_template` | Create from master | `--template`, `--output` |
| `ppt_create_from_structure` | Generate from JSON | `--structure`, `--output` |
| `ppt_clone_presentation` | Create work copy | `--source`, `--output` |

### Domain 2: Slide Management (6 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_add_slide` | Insert slide | Returns new index |
| `ppt_delete_slide` | Remove slide | âš ï¸ Requires approval token |
| `ppt_duplicate_slide` | Clone slide | Returns new index |
| `ppt_reorder_slides` | Move slide | `--from-index`, `--to-index` |
| `ppt_set_slide_layout` | Change layout | Probe first for available layouts |
| `ppt_set_footer` | Configure footer | Dual strategy (placeholder + text box) |

### Domain 3: Text & Content (6 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_set_title` | Set title/subtitle | Uses layout placeholders |
| `ppt_add_text_box` | Add text box | Full formatting support |
| `ppt_add_bullet_list` | Add bullets | Styles: bullet, numbered, none |
| `ppt_format_text` | Style text | Font, size, color, bold, italic |
| `ppt_replace_text` | Find/replace (v2.0) | Dry-run + scoped replacement |
| `ppt_add_notes` | Speaker notes | Modes: append, prepend, overwrite |

### Domain 4: Images & Media (4 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_insert_image` | Insert image | Alt-text for accessibility |
| `ppt_replace_image` | Swap images | Match by name |
| `ppt_crop_image` | Crop image | Percentage-based crop box |
| `ppt_set_image_properties` | Set alt text | Accessibility compliance |

### Domain 5: Visual Design (6 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_add_shape` | Add shapes | Full opacity support (v3.1.0) |
| `ppt_format_shape` | Style shapes | `fill_opacity`, `line_opacity` |
| `ppt_add_connector` | Connect shapes | Types: straight, elbow, curve |
| `ppt_set_background` | Set background | Color or image |
| `ppt_set_z_order` | Manage layers | âš ï¸ Refresh indices after |
| `ppt_remove_shape` | Delete shape | âš ï¸ Requires approval token |

### Domain 6: Data Visualization (4 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_add_chart` | Add chart | Types: column, bar, line, pie |
| `ppt_update_chart_data` | Update data | âš ï¸ Limited by python-pptx |
| `ppt_format_chart` | Style chart | Title, legend, colors |
| `ppt_add_table` | Add table | 2D data array input |

### Domain 7: Inspection & Analysis (4 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_get_info` | Get metadata | Returns `presentation_version` |
| `ppt_get_slide_info` | Inspect shapes | Use after structural changes |
| `ppt_extract_notes` | Get all notes | Returns Dict[int, str] |
| `ppt_capability_probe` | Deep inspection | `--deep` for transient slide analysis |

### Domain 8: Validation & Output (4 tools)
| Tool | Purpose | Notes |
|------|---------|-------|
| `ppt_validate_presentation` | Health check | Empty slides, missing assets |
| `ppt_check_accessibility` | WCAG audit | Alt text, contrast, reading order |
| `ppt_export_images` | Export as images | PNG or JPG |
| `ppt_export_pdf` | Export as PDF | Requires LibreOffice |

---

# Part II: THE WHY â€” Design Rationale & Architecture

## 2.1 The Four Pillars (Design Contract)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          THE FOUR PILLARS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     STATELESS      â”‚      ATOMIC        â”‚    COMPOSABLE      â”‚  ACCESSIBLE  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Each call is       â”‚ Open â†’ Modify â†’    â”‚ Tools can be       â”‚ WCAG 2.1     â”‚
â”‚ independent        â”‚ Save â†’ Close       â”‚ chained            â”‚ compliance   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ No memory of       â”‚ One action per     â”‚ Output feeds       â”‚ Alt text,    â”‚
â”‚ previous calls     â”‚ call               â”‚ next input         â”‚ contrast,    â”‚
â”‚                    â”‚                    â”‚                    â”‚ reading orderâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              + VISUAL-AWARE                                  â”‚
â”‚           Typography scales â€¢ Color theory â€¢ Content density                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Statelessness?

| Reason | Explanation |
|--------|-------------|
| **AI Context Loss** | Agents may lose context between calls |
| **Parallel Execution** | Prevents race conditions in concurrent workflows |
| **Pipeline Composition** | Enables `tool1 | tool2 | tool3` patterns |
| **Error Recovery** | Each call is self-contained, simplifying retry logic |
| **Determinism** | Same inputs â†’ same outputs, always |

### Why Atomic Operations?

| Reason | Explanation |
|--------|-------------|
| **Predictability** | One file state change per invocation |
| **Auditability** | Each change is traceable |
| **Rollback** | If something fails, only one operation to undo |
| **Resource Safety** | File locks released after each operation |

## 2.2 Hub-and-Spoke Architecture Rationale

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   AI Agent / Human      â”‚
                         â”‚   (Orchestration Layer) â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                         â”‚                         â”‚
           â–¼                         â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SPOKE: CLI  â”‚           â”‚ SPOKE: CLI  â”‚           â”‚ SPOKE: CLI  â”‚
    â”‚ ppt_add_    â”‚           â”‚ ppt_get_    â”‚           â”‚ ppt_validateâ”‚
    â”‚ shape.py    â”‚           â”‚ slide_info  â”‚           â”‚ _present.   â”‚
    â”‚             â”‚           â”‚             â”‚           â”‚             â”‚
    â”‚ â€¢ argparse  â”‚           â”‚ â€¢ argparse  â”‚           â”‚ â€¢ argparse  â”‚
    â”‚ â€¢ JSON I/O  â”‚           â”‚ â€¢ JSON I/O  â”‚           â”‚ â€¢ JSON I/O  â”‚
    â”‚ â€¢ Thin      â”‚           â”‚ â€¢ Thin      â”‚           â”‚ â€¢ Thin      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                         â”‚
                    â”‚        HUB: powerpoint_agent_core.py    â”‚
                    â”‚                                         â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚   â”‚   PowerPointAgent Class         â”‚   â”‚
                    â”‚   â”‚   â€¢ File locking                â”‚   â”‚
                    â”‚   â”‚   â€¢ XML manipulation            â”‚   â”‚
                    â”‚   â”‚   â€¢ Position/Size resolution    â”‚   â”‚
                    â”‚   â”‚   â€¢ Color helpers               â”‚   â”‚
                    â”‚   â”‚   â€¢ Version hashing             â”‚   â”‚
                    â”‚   â”‚   â€¢ Approval token validation   â”‚   â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              python-pptx                â”‚
                    â”‚         (Underlying Library)            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why This Architecture?

| Aspect | Hub Responsibility | Spoke Responsibility |
|--------|-------------------|---------------------|
| **Complexity** | Encapsulates all PPTX manipulation | Simple CLI wrapper |
| **Testing** | Unit tests on core logic | Integration tests on CLI |
| **Security** | Path validation, approval tokens | Argument parsing |
| **Consistency** | Single source of truth | Standardized interface |
| **Maintainability** | One place to fix bugs | Easy to add new tools |

## 2.3 Safety Hierarchy (Governance Foundation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SAFETY HIERARCHY (in order of precedence)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Never perform destructive operations without approval                    â”‚
â”‚  2. Always work on cloned copies, never source files                        â”‚
â”‚  3. Validate before delivery, always                                        â”‚
â”‚  4. Fail safelyâ€”incomplete is better than corrupted                         â”‚
â”‚  5. Document everything for audit and rollback                              â”‚
â”‚  6. Refresh indices after structural changes                                â”‚
â”‚  7. Dry-run before actual execution for replacements                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Clone-Before-Edit?

| Scenario | Without Clone | With Clone |
|----------|---------------|------------|
| Script crashes mid-operation | Source file corrupted | Source file untouched |
| User changes mind | Cannot undo | Delete work copy |
| Multiple iterations | Accumulating damage | Fresh copy each time |
| Audit requirements | No baseline | Original preserved |

### Why Approval Tokens for Destructive Operations?

| Operation | Risk | Token Requirement |
|-----------|------|-------------------|
| `delete_slide` | Permanent data loss | Required |
| `remove_shape` | Content deletion | Required |
| Mass replacement | Unintended changes | Required without dry-run |
| Background replacement (all) | Visual disruption | Required |

## 2.4 The Shape Index Problem â€” Explained

**Root Cause**: PowerPoint stores shapes in an XML tree. The "index" is just the position in that tree. When you add, remove, or reorder shapes, positions shift.

```
BEFORE remove_shape(index=1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shape Tree                  â”‚
â”‚ â”œâ”€â”€ [0] Title               â”‚
â”‚ â”œâ”€â”€ [1] Rectangle â† DELETE  â”‚
â”‚ â”œâ”€â”€ [2] Circle              â”‚
â”‚ â””â”€â”€ [3] Arrow               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER remove_shape(index=1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shape Tree                  â”‚
â”‚ â”œâ”€â”€ [0] Title               â”‚
â”‚ â”œâ”€â”€ [1] Circle   â† WAS [2]  â”‚
â”‚ â””â”€â”€ [2] Arrow    â† WAS [3]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Solution**: Always call `get_slide_info()` after structural operations and use fresh indices.

## 2.5 Opacity vs Transparency â€” The Migration

| Aspect | Old (Deprecated) | New (v3.1.0+) |
|--------|------------------|---------------|
| **Parameter** | `transparency` | `fill_opacity` |
| **Scale** | 1.0 = invisible | 1.0 = opaque |
| **Intuition** | Inverted | Natural |
| **Conversion** | `opacity = 1.0 - transparency` | Direct use |
| **Status** | Logs warning, auto-converts | Preferred |

**Why the change?** The term "opacity" is more intuitiveâ€”higher values mean "more visible," which matches user expectations.

---

# Part III: THE HOW â€” Implementation Patterns & Workflows

## 3.1 The 5-Phase Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          THE 5-PHASE WORKFLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   DISCOVER     â”‚     PLAN       â”‚    CREATE      â”‚   VALIDATE     â”‚ DELIVER â”‚
â”‚   (Phase 1)    â”‚   (Phase 2)    â”‚   (Phase 3)    â”‚   (Phase 4)    â”‚(Phase 5)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Probe file   â”‚ â€¢ Create       â”‚ â€¢ Execute      â”‚ â€¢ Structural   â”‚ â€¢ Exportâ”‚
â”‚ â€¢ Extract      â”‚   manifest     â”‚   operations   â”‚   validation   â”‚ â€¢ Docum.â”‚
â”‚   metadata     â”‚ â€¢ Design       â”‚ â€¢ Track        â”‚ â€¢ Accessibilityâ”‚ â€¢ Audit â”‚
â”‚ â€¢ Discover     â”‚   decisions    â”‚   versions     â”‚   audit        â”‚   trail â”‚
â”‚   layouts      â”‚ â€¢ Risk         â”‚ â€¢ Refresh      â”‚ â€¢ Design       â”‚ â€¢ Hand- â”‚
â”‚ â€¢ Baseline     â”‚   assessment   â”‚   indices      â”‚   coherence    â”‚   off   â”‚
â”‚   state        â”‚                â”‚                â”‚                â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ capability_    â”‚ manifest.json  â”‚ add_shape      â”‚ validate_      â”‚ export_ â”‚
â”‚ probe          â”‚ structure.json â”‚ format_shape   â”‚ presentation   â”‚ pdf     â”‚
â”‚ get_info       â”‚                â”‚ replace_text   â”‚ check_         â”‚ extract_â”‚
â”‚ get_slide_info â”‚                â”‚ add_notes      â”‚ accessibility  â”‚ notes   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.2 The Golden Workflow Pattern

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PHASE 1: DISCOVER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Step 1.1: Clone source file (NEVER edit source directly)
uv run tools/ppt_clone_presentation.py \
  --source /source/template.pptx \
  --output /work/project.pptx \
  --json

# Step 1.2: Deep probe to discover capabilities
uv run tools/ppt_capability_probe.py \
  --file /work/project.pptx \
  --deep \
  --json > probe_output.json

# Step 1.3: Capture initial version
VERSION_INITIAL=$(uv run tools/ppt_get_info.py \
  --file /work/project.pptx \
  --json | jq -r '.presentation_version')

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PHASE 2: PLAN (create manifest - conceptual)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Document planned operations, design decisions, and rollback commands

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PHASE 3: CREATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Step 3.1: Add content
uv run tools/ppt_add_shape.py \
  --file /work/project.pptx \
  --slide 0 \
  --shape rectangle \
  --position '{"left":"10%","top":"10%"}' \
  --size '{"width":"80%","height":"80%"}' \
  --fill-color "#0070C0" \
  --fill-opacity 0.15 \
  --json

# Step 3.2: IMMEDIATELY refresh indices after structural change
uv run tools/ppt_get_slide_info.py \
  --file /work/project.pptx \
  --slide 0 \
  --json > slide0_shapes.json

# Step 3.3: Use fresh indices for subsequent operations
NEW_SHAPE_IDX=$(jq '.shapes | length - 1' slide0_shapes.json)

uv run tools/ppt_set_z_order.py \
  --file /work/project.pptx \
  --slide 0 \
  --shape $NEW_SHAPE_IDX \
  --action send_to_back \
  --json

# Step 3.4: Refresh indices AGAIN after z-order change
uv run tools/ppt_get_slide_info.py \
  --file /work/project.pptx \
  --slide 0 \
  --json > slide0_shapes_v2.json

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PHASE 4: VALIDATE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Step 4.1: Structural validation
uv run tools/ppt_validate_presentation.py \
  --file /work/project.pptx \
  --json

# Step 4.2: Accessibility audit
uv run tools/ppt_check_accessibility.py \
  --file /work/project.pptx \
  --json

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PHASE 5: DELIVER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Step 5.1: Export to PDF
uv run tools/ppt_export_pdf.py \
  --file /work/project.pptx \
  --output /delivery/project.pdf \
  --json

# Step 5.2: Extract notes for speaker
uv run tools/ppt_extract_notes.py \
  --file /work/project.pptx \
  --json > /delivery/speaker_notes.json
```

## 3.3 Critical Implementation Patterns

### Pattern 1: The Overlay Pattern (Text Readability)

```python
# Complete workflow for adding a semi-transparent overlay

# 1. Add overlay shape
result = agent.add_shape(
    slide_index=0,
    shape_type="rectangle",
    position={"left": "0%", "top": "0%"},
    size={"width": "100%", "height": "100%"},
    fill_color="#FFFFFF",
    fill_opacity=0.15  # Subtle, non-competing
)
overlay_index = result["shape_index"]

# 2. IMMEDIATELY refresh indices
slide_info = agent.get_slide_info(slide_index=0)

# 3. Send overlay to back
agent.set_z_order(
    slide_index=0,
    shape_index=overlay_index,
    action="send_to_back"
)

# 4. IMMEDIATELY refresh indices again
slide_info = agent.get_slide_info(slide_index=0)
```

### Pattern 2: The Probe-First Pattern (Layout Discovery)

```python
# âŒ WRONG - guessing layout names
agent.add_slide(layout_name="Title and Content")  # Might not exist!

# âœ… CORRECT - probe first
with PowerPointAgent(filepath) as agent:
    agent.open(filepath)
    probe_result = agent.get_capabilities(deep=True)
    
    available_layouts = probe_result["layouts"]
    print(f"Available: {[l['name'] for l in available_layouts]}")
    
    # Use discovered layout
    if any(l['name'] == 'Title and Content' for l in available_layouts):
        agent.add_slide(layout_name='Title and Content')
    else:
        agent.add_slide(layout_name=available_layouts[0]['name'])
    
    agent.save()
```

### Pattern 3: The Version Tracking Pattern

```python
# Every mutation must track versions

with PowerPointAgent(filepath) as agent:
    agent.open(filepath)
    
    # Capture BEFORE state
    info_before = agent.get_presentation_info()
    version_before = info_before["presentation_version"]
    
    # Perform mutation
    result = agent.add_shape(...)
    
    # Save changes
    agent.save()
    
    # Capture AFTER state
    info_after = agent.get_presentation_info()
    version_after = info_after["presentation_version"]
    
    # Return with version tracking
    return {
        "status": "success",
        "presentation_version_before": version_before,
        "presentation_version_after": version_after,
        "changes": result
    }
```

### Pattern 4: The Probe Resilience Pattern (Discovery Tools)

```python
import time
from contextlib import contextmanager

@contextmanager
def _transient_slide(prs, layout):
    """Add slide for analysis, then remove it."""
    slide = None
    added_index = -1
    try:
        slide = prs.slides.add_slide(layout)
        added_index = len(prs.slides) - 1
        yield slide
    finally:
        if added_index != -1:
            try:
                rId = prs.slides._sldIdLst[added_index].rId
                prs.part.drop_rel(rId)
                del prs.slides._sldIdLst[added_index]
            except Exception:
                pass  # File not saved, so no harm

def probe_with_resilience(filepath: Path, timeout_seconds: int = 15):
    """Probe with timeout + transient slides + graceful degradation."""
    
    start_time = time.perf_counter()
    warnings = []
    results = []
    
    prs = Presentation(str(filepath))
    
    for idx, layout in enumerate(prs.slide_layouts):
        # Timeout check at each iteration
        if (time.perf_counter() - start_time) > timeout_seconds:
            warnings.append(f"Timeout at layout {idx}")
            break
        
        # Use transient slide for accurate analysis
        with _transient_slide(prs, layout) as slide:
            results.append(analyze_slide(slide))
    
    return {
        "status": "success",
        "layouts_analyzed": len(results),
        "layouts_total": len(prs.slide_layouts),
        "analysis_complete": len(results) == len(prs.slide_layouts),
        "layouts": results,
        "warnings": warnings
    }
```

## 3.4 Error Handling Standards

### Exit Code Matrix

| Code | Category | Meaning | Retryable |
|------|----------|---------|-----------|
| `0` | Success | Operation completed | N/A |
| `1` | Usage Error | Invalid arguments | No |
| `2` | Validation Error | Schema/content invalid | No |
| `3` | Transient Error | Timeout, I/O, network | Yes |
| `4` | Permission Error | Approval token missing | No |
| `5` | Internal Error | Unexpected failure | Maybe |

### Standard Error Response Format

```json
{
  "status": "error",
  "error": "Human-readable message",
  "error_type": "SlideNotFoundError",
  "details": {
    "requested": 10,
    "available": 5
  },
  "suggestion": "Use ppt_get_info.py to check available slides",
  "retryable": false
}
```

## 3.5 JSON Output Hygiene

**The Prime Directive**: STDOUT is exclusively for the final JSON payload.

```python
#!/usr/bin/env python3
import sys
import os

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HYGIENE BLOCK â€” Must be FIRST (before any other imports)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
sys.stderr = open(os.devnull, 'w')

# Now safe to import libraries that might print warnings
import json
import argparse
from pathlib import Path
# ... rest of imports ...
```

**Why?** Some libraries (including `python-pptx`) print warnings to stderr. If these leak to stdout, JSON parsing fails. The hygiene block redirects stderr to /dev/null immediately.

## 3.6 Data Structure Quick Reference

### Position Dictionary

| Type | Format | Example |
|------|--------|---------|
| **Percentage** | `{"left": "N%", "top": "N%"}` | `{"left": "10%", "top": "20%"}` |
| **Inches** | `{"left": N, "top": N}` | `{"left": 1.5, "top": 2.0}` |
| **Anchor** | `{"anchor": "...", "offset_x": N, "offset_y": N}` | `{"anchor": "center", "offset_x": 0, "offset_y": -0.5}` |
| **Grid** | `{"grid_row": N, "grid_col": N, "grid_size": 12}` | `{"grid_row": 2, "grid_col": 3, "grid_size": 12}` |

**Anchors**: `top_left`, `top_center`, `top_right`, `center_left`, `center`, `center_right`, `bottom_left`, `bottom_center`, `bottom_right`

### Size Dictionary

| Type | Format | Example |
|------|--------|---------|
| **Percentage** | `{"width": "N%", "height": "N%"}` | `{"width": "50%", "height": "40%"}` |
| **Inches** | `{"width": N, "height": N}` | `{"width": 5.0, "height": 3.0}` |
| **Auto** | `{"width": "N%", "height": "auto"}` | `{"width": "50%", "height": "auto"}` |

### Opacity Reference

| Value | Appearance | Use Case |
|-------|------------|----------|
| `0.0` | Invisible | Hidden elements |
| `0.15` | Subtle | Text overlays |
| `0.5` | Half | Watermarks |
| `1.0` | Solid | Normal shapes |

---

# Part IV: Implementation Checklist (Consolidated)

## Pre-Development Checklist

- [ ] **Read architecture docs** â€” Understand hub-and-spoke model
- [ ] **Check existing tools** â€” Don't duplicate functionality
- [ ] **Identify phase** â€” Which workflow phase does this tool belong to?
- [ ] **Assess risk** â€” Does this operation require approval tokens?

## Tool Development Checklist

### Code Structure
- [ ] Hygiene block at top (stderr redirect)
- [ ] Path setup for core imports
- [ ] argparse with `--json` flag
- [ ] Context manager for PowerPointAgent
- [ ] Single JSON output to stdout
- [ ] Exit code 0/1 (or 0-5 for advanced)

### Governance & Safety
- [ ] Clone-before-edit enforcement (check for `/work/` prefix)
- [ ] Approval token validation for destructive operations
- [ ] Version tracking (before/after)
- [ ] Shape index refresh after structural changes

### Error Handling
- [ ] FileNotFoundError handling
- [ ] SlideNotFoundError handling
- [ ] ShapeNotFoundError handling
- [ ] PermissionError handling
- [ ] Generic catch-all with JSON output

### Testing
- [ ] Happy path tests
- [ ] Edge case tests (0, 1, max, empty)
- [ ] Error case tests
- [ ] CLI integration tests (valid JSON output)
- [ ] Governance tests (token enforcement, index refresh)

### Documentation
- [ ] Module docstring with usage
- [ ] Function docstrings with Args/Returns/Raises
- [ ] Type hints on all signatures
- [ ] Phase classification in metadata

---

# Part V: Quick Reference Card

## Five Golden Rules

| # | Rule | Why |
|---|------|-----|
| ğŸ”’ | **Clone** | Never edit source files |
| ğŸ” | **Probe** | Discover before guessing |
| ğŸ”„ | **Refresh** | Indices shift after changes |
| ğŸ“Š | **JSON** | stdout is for JSON only |
| â™¿ | **Validate** | Check accessibility always |

## Essential Commands

```bash
# Clone (always first)
ppt_clone_presentation.py --source X.pptx --output Y.pptx --json

# Probe (discover template)
ppt_capability_probe.py --file Y.pptx --deep --json

# Refresh (after structural changes)
ppt_get_slide_info.py --file Y.pptx --slide N --json

# Overlay (for readability)
ppt_add_shape.py --file Y.pptx --slide N --shape rectangle \
  --position '{"left":"0%","top":"0%"}' \
  --size '{"width":"100%","height":"100%"}' \
  --fill-color "#FFFFFF" --fill-opacity 0.15 --json

# Validate (before delivery)
ppt_check_accessibility.py --file Y.pptx --json
```

## Common Gotchas

| Issue | Symptom | Fix |
|-------|---------|-----|
| Stale indices | `ShapeNotFoundError` | Call `get_slide_info()` after structural ops |
| Layout not found | `LayoutNotFoundError` | Use probe to discover layouts first |
| JSON parse error | `jq: parse error` | Apply hygiene block, check for print statements |
| Version mismatch | Unexpected changes | Re-probe, verify no external modifications |
| Permission denied | Token error | Generate approval token with correct scope |

---

# Conclusion

I now have a comprehensive understanding of the **PowerPoint Agent Tools** project:

- **WHAT**: A suite of 39 stateless CLI tools for AI-driven presentation engineering, built on a hub-and-spoke architecture with the `PowerPointAgent` class as the core
- **WHY**: Designed for safety (clone-before-edit, approval tokens), reliability (atomic operations, version tracking), and accessibility (WCAG 2.1 compliance)
- **HOW**: 5-phase workflow (Discover â†’ Plan â†’ Create â†’ Validate â†’ Deliver), JSON-first I/O, strict error handling, and governance enforcement

I am **fully prepared** to assist with any coding tasks for this project, including:
- Creating new CLI tools following the established patterns
- Debugging existing tools
- Implementing new core features
- Writing tests
- Reviewing code for compliance with project standards

**What would you like to work on?** ğŸ› ï¸
